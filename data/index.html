<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/darkly/bootstrap.min.css" rel="stylesheet">
    <title>Simulator Control Panel</title>
</head>

<body class="bg-dark col-12 vh-100 mt-4 vh-100">
  <div class="d-flex justify-content-center align-items-center">
    <div id="StartPage" class="card col-12 col-lg-9 bg-secondary mt-5" style="border-radius:0.15rm; border: solid #375a7f 3px;">
        <div class="card-header col-12 text-center text-info">
          <div class="d-flex justify-content-start">
          <button class="col-1 btn btn-sm btn-danger text-center mt-3" type="button" id="btnExit" data-status="exit"> Exit</button>
          </div>
          <h2>Simulator Home Page</h2>
        </div>
        <div class="card-body col-12 d-flex flex-column justify-content-center align-items-center">
          <h5 class="card-title mb-3">Please enter the name of your config file and or set a runtime</h5>
          <form class="d-flex flex-row justify-content-evenly col-10">
            <div class="col-6">
              <label for="txtFileName" class ='form-label mt-3' >Enter name of config file (in program_path/data): </label>
              <input id="txtFileName" class="col-12 form-control" style="text-align: center;" placeholder="Filename">
             </div> 
             <div class="col-6">
              <label for="timeLim" class ='form-label mt-3' >Enter optional runtime in minutes, blank for continous:</label>
              <input type="number" class="col-12 form-control text-center" id="timeLim" placeholder="80"> 
            </div>  
          </form>
   

          <button class="col-10 btn btn-lg btn-success text-center mt-3" type="button" id="btnStart" data-status="start"> Start The Simulator </button>
          <!-- <h3>Click to exit the Simulator</h3> -->
          
        </div> 
      </div>
  </div>    
      
  <div id="ControlPanel" class="card col-12 bg-secondary mt-5" style="display: none; border-radius:0.15rm; border: solid #375a7f 3px;">
      <div class="card-header col-12 text-center text-info">
        <div class="d-flex justify-content-start">
          <button class="col-1 btn btn-sm btn-danger text-center" type="button" id="btnBack" data-status="Back"> Back to Home </button>
        </div>
          <h2>Simulator Control Panel</h2>
      </div>    
      <div class="card-body d-flex flex-column justify-content-center align-items-center">
        <!--<div class="col-12 ">
          <h4>Progress:</h4>
          <div class="progress mt-5">
            <div class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 25%;" aria-valuenow='#txtTime' aria-valuemin="0" aria-valuemax=timeLim></div>
          </div>
          !-->
          <div class="d-flex flex-row col-10 justify-content-around" 
          style="display: none; border-radius:0.15rm; border: solid #375a7f 3px;">
            <div class="d-flex flex-column col-4">
              <h4>Time Unpaused:</h4>
              <p id="txtTimeUnpaused">00:00:00</p>
            </div>
            <div class="d-flex flex-column col-4">
              <h4>Time Total:</h4>
              <p id="txtTimeTotal">00:00:00</p>
            </div>
        </div>
      <div class="card-body col-12 d-flex flex-row justify-content-center align-items-center">
        <button class="btn btn-lg btn-warning text-center mx-3" type="button" id="btnPause" data-status="pause"> Pause Simulator </button>
        <button class="btn btn-lg btn-success text-center mx-3" type="button" id="btnResume" data-status="start"> Resume Simulator </button>
        <button class="btn btn-lg btn-danger text-center mx-3" type="button" id="btnClose" data-status="Close"> Stop Current Simulation </button>   
      </div> 
  </div>   


    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>



<script>
$(document).ready(function(){
  $.ajax({
    type: 'GET',
    url: 'http://localhost:8080/simState',
    error: function(error) {
      console.log(error);
    },
    success: function(success) {
      console.log(success);
      if (success.state == "running" || success.state == "paused") {
        var timeTracker = window.setInterval(function() {
          $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/getTime',
            error: function(e) {
              console.log(e);
            },
            success: function(result) {
              console.log(result);

              let activeSeconds = result.activeTime / 1000000;
              const date = new Date(null)
              date.setSeconds(activeSeconds)
              const timeActiveFormatted = date.toISOString().substring(11,19)
              $('#txtTimeUnpaused').text(timeActiveFormatted);

              let totalSeconds = result.runningTime / 1000000;
              date.setSeconds(totalSeconds);
              const timeTotalFormatted = date.toISOString().substring(11, 19);
              $('#txtTimeTotal').text(timeTotalFormatted);
            }
          });
        }, 1000);

        $('#StartPage').hide();
        $('#ControlPanel').show();

        if (success.state == "running") {
          $('#btnPause').prop('disabled', false)
          $('#btnResume').prop('disabled', true)
        }
        else {
          $('#btnPause').prop('disabled', true)
          $('#btnResume').prop('disabled', false)
        }
      }
    }
  })

  // disables the pause button until the start button has been clicked
  $('#btnPause').prop('disabled', true);
  let running = false
  // event to change start button to stop and vice versa
  $('#btnStart').on('click',function(){
    let strStatus = $(this).attr('data-status');
    if(strStatus == 'start'){
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/setConfig?config=' + encodeURIComponent($('#txtFileName').val()),
        error: function(error){
          console.log(error)
        },
        success: function(success){
          let timeLim = $('#timeLim').val()
          if (timeLim == '' || timeLim == undefined){
            timeLim = 0
          }
          var timeTracker = window.setInterval(function() {
            $.ajax({
              type: 'GET',
              url: 'http://localhost:8080/getTime',
              error: function(e) {
                console.log(e);
              },
              success: function(result) {
                console.log(result);

                let activeSeconds = result.activeTime / 1000000;
                const date = new Date(null)
                date.setSeconds(activeSeconds)
                const timeActiveFormatted = date.toISOString().substring(11,19)
                $('#txtTimeUnpaused').text(timeActiveFormatted);

                let totalSeconds = result.runningTime / 1000000;
                date.setSeconds(totalSeconds);
                const timeTotalFormatted = date.toISOString().substring(11, 19);
                $('#txtTimeTotal').text(timeTotalFormatted);
              }
            });
          }, 1000)

          $.ajax({
            type: 'POST',
            url:'http://localhost:8080/setTimer?timer=' + encodeURIComponent(timeLim),
            error: function(error){
              console.log(error)
            },
            success: function(){
              $.ajax({
                type: 'POST',
                url: 'http://localhost:8080/toggleSim',
                error: function(error){
                  console.log(error)
                },
                success: function(success){
                  console.log(success)
                  running = true
                  $('#StartPage').slideToggle(function(){
                    $('#ControlPanel').slideToggle();
                  })
                  $('#btnPause').prop('disabled', false)
                  $('#btnResume').prop('disabled', true)
                }
              })
            }
            
          })
          
        }
      })
    }      
  });

  //event for back button
  $('#btnBack').on('click', function(){
    if (running == true){ 
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/toggleSim',
        error: function(error){
          console.log(error)
        },
        success: function(success){
          console.log(success)
          running = false
          $('#ControlPanel').slideToggle(function(){
            $('#StartPage').slideToggle();
          })
        },
      })
    }
    else{
      $('#ControlPanel').slideToggle(function(){
        $('#StartPage').slideToggle();
      })
    }
  })

  // event to for pause button click
  $('#btnPause').on('click',function(){
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/suspendSim',
        error: function(error){
          console.log(error)
        },
        success: function(success){
          console.log(success)
          $('#btnPause').prop('disabled', true)
          $('#btnResume').prop('disabled', false)
        }
      })
    });

  //event for resume button click
  $('#btnResume').on('click',function(){
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/suspendSim',
        error: function(error){
          console.log(error)
        },
        success: function(success){
          console.log(success)
          $('#btnPause').prop('disabled', false)
          $('#btnResume').prop('disabled', true)
        }
      })
  });
  //event for close button click
  $('#btnClose').on('click',function(){
    let strStatus = $(this).attr('data-status');
    if(strStatus == 'Close'){
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/toggleSim',
        error: function(error){
          console.log(error)
        },
        success: function(success){
          console.log(success)
          running = false
          $('#btnPause').prop('disabled', true)
          $('#btnResume').prop('disabled', true)
          //possibly stuck in disabled? no bc successful start click will change it back?
        }
      })
    }
  });

  //for exiting entire program
  $('#btnExit').on('click',function(){
    let strStatus = $(this).attr('data-status');
    if(strStatus == 'exit'){
      $.ajax({
        type: 'POST',
        url: 'http://localhost:8080/exitSim',
        error: function(error){
          console.log(error)
        },
        success: function(success){
          console.log(success)
          running = false;
          $('#divControlPanel').slideToggle(function(){
            $('#divStartPage').slideToggle();
          })
          $('#btnPause').prop('disabled', true)
          $('#btnResume').prop('disabled', true)
        }
      })
    }
  });
});
</script>
